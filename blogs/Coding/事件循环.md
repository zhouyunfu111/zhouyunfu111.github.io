---
top: 1
categories:
  - coding
tags:
  - js
date: 2021-03-07
title: 事件循环机制
---

## 事件循环基础

**宏任务:** script(整体代码)，setTimeout,setInterval,setImmediate,I/O,UI rendring

**微任务:** promise,object.observe,MuationObserver

任务的优先级：process.nextTick > promise.then > setTimeout > setImmediate

微任务会在当前宏任务后面执行，代码执行到一个微任务就添加到微任务栈。直到当前宏任务没有微任务栈。在执行下一个宏任务

## 浏览器的多线程

### 1.GUI 渲染线程

- 绘制页面，解析HTML、CSS、创建DOM树，布局和绘制等

- 页面重绘和回流

- 与JS引擎线程互斥、也就是所谓的JS执行阻塞页面更新

### 2.JS引擎线程

- 负责JS脚本代码的执行

- 负责准执行准备好待执行的事件，即定时器计数结束，或是异步请求成功正确返回的事件

- 与GUI渲染线程互斥，执行时间过长将阻塞页面的渲染

### 3.事件触发线程

- 负责将准备好的事件交给JS引擎线程执行

- 多个事件加入任务队列的时候需要排队等待(JS的单线程)

### 4.定时器触发线程

- 负责执行异步的定时器类的事件，如setTiemout、setInterval

- 定时器到时间之后把注册的回调加入到任务列的队尾

### 5.HTTP请求线程

- 负责执行异步请求

- 主线程执行代码遇到异步请求的时候会把函数交给该线程处理，当监听到状态变更事件，如果有回调函数，该线程会把回调加入到任务队列的队尾等待执行




